#!/bin/bash
# Copyright 2010 Rorschach <r0rschach@lavabit.com>
# Copyright 2011 aericson <de.ericson@gmail.com>
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.


# put this file into /etc/cron.hourly and replace rorschach with your username

arch_user=rorschach

if [ -z "$(pgrep pacman)" ];then
        /usr/bin/pacman -Sy > /dev/null
fi

# RUNNING AARCHUP

su - $arch_user -c "XAUTHORITY=/home/$arch_user/.Xauthority DISPLAY=:0.0 /usr/bin/aarchup --uid $(id -u $arch_user) --icon /usr/share/aarchup/archlogo.svg"

# IF YOU USE GDM PLEASE UNCOMMENT THE FOLLOWIN AND COMMENT THE ABOVE

#GSPID=$(pidof gnome-shell)
#if [ -e "/proc/$GSPID/environ" ]; then
# export $(</proc/$GSPID/environ tr \\0 \\n | grep -E '^DBUS_SESSION_BUS_ADDRESS=')
# export XAUTHORITY=$(/usr/bin/find /var/run/gdm -path "*${arch_user}*/database")
# export DISPLAY=:0
# /usr/bin/aarchup  --uid $(id -u $arch_user) --icon /usr/share/aarchup/archlogo.svg
#fi
